<app-header />

<app-auth-card>
  <section card-copy class="login-copy">
    <p class="eyebrow">Secure access</p>
    <h1>Welcome back to Zenith</h1>
    <p>Authenticate once and keep every treasury action synced across mobile and desktop.</p>

    <ul class="copy-points">
      <li>Layered PIN + password control</li>
      <li>Google sign-in available any time</li>
      <li>Session alerts on every device</li>
    </ul>
  </section>

  <form
    card-content
    class="auth-form login-form"
    [formGroup]="loginForm"
    (ngSubmit)="onSubmit()"
  >
    <h3 class="form-title">Sign in</h3>

    <label class="form-field">
      <span>PIN code</span>
      <input
        id="pinCode"
        type="password"
        formControlName="pinCode"
        placeholder="Enter 4-6 digit PIN"
        maxlength="6"
        inputmode="numeric"
        class="pin-input"
        (input)="onPinInput($event)"
        [class.invalid]="loginForm.get('pinCode')?.invalid && loginForm.get('pinCode')?.touched"
      />
      @if (loginForm.get('pinCode')?.invalid && loginForm.get('pinCode')?.touched) {
        <span class="error-text">PIN code must be 4-6 digits</span>
      }
    </label>

    <label class="form-field">
      <div class="field-heading">
        <span>Password</span>
        <button type="button" class="text-link" (click)="onForgotPassword()">Forgot?</button>
      </div>
      <input
        id="password"
        type="password"
        formControlName="password"
        placeholder="Enter your password"
        [class.invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched"
      />
      @if (loginForm.get('password')?.invalid && loginForm.get('password')?.touched) {
        <span class="error-text">Password must be at least 6 characters</span>
      }
    </label>

    @if (errorMessage()) {
      <div class="status-message error">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
          <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 13H7v-2h2v2zm0-3H7V4h2v6z" />
        </svg>
        {{ errorMessage() }}
      </div>
    }

    <button
      type="submit"
      class="primary"
      [disabled]="loginForm.invalid || isLoading()"
    >
      @if (isLoading()) {
        <span class="spinner"></span>
        <span>Authenticating...</span>
      } @else {
        <span>Sign in</span>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
          <path d="M8 0L6.59 1.41 12.17 7H0v2h12.17l-5.58 5.59L8 16l8-8z" />
        </svg>
      }
    </button>

    <div class="divider">
      <span>or continue with</span>
    </div>

    <button type="button" class="oauth-button" (click)="loginWithGoogle()">
      <svg viewBox="0 0 533.5 544.3" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path fill="#4285F4" d="M533.5 278.4c0-17.4-1.4-34-4-50.2H272v95.1h146.9c-6.4 34.6-26 63.9-55.4 83.4v69.2h89.4c52.4-48.3 80.6-119.5 80.6-197.5z" />
        <path fill="#34A853" d="M272 544.3c74.7 0 137.4-24.7 183.2-67.4l-89.4-69.2c-24.8 16.7-56.6 26.5-93.8 26.5-72 0-133-48.6-154.6-113.8H24.5v71.4C70.5 483.1 164.6 544.3 272 544.3z" />
        <path fill="#FBBC05" d="M117.4 320.4c-10.5-31.6-10.5-65.7 0-97.3V151.7H24.5c-44.2 87.9-44.2 192.8 0 280.6l92.9-71.9z" />
        <path fill="#EA4335" d="M272 107.7c39.6-.6 77.3 14 106.1 41.3l79.1-79.1C409.3 24.3 345.9-2.1 272 0 164.6 0 70.5 61.2 24.5 151.7l92.9 71.4C139 156.3 200 107.7 272 107.7z" />
      </svg>
      <span>Sign in with Google</span>
    </button>

    <div class="register-hint">
      <span>New to Zenith?</span>
      <a routerLink="/register">Create an account</a>
    </div>
  </form>
</app-auth-card>

@if (showForgotPassword()) {
  <div class="modal-overlay" (click)="onCloseForgotPassword()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Reset password</h3>
        <button type="button" class="close-button" (click)="onCloseForgotPassword()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path d="M10 8.586 2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z" />
          </svg>
        </button>
      </div>

      <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmitForgotPassword()" class="forgot-password-form">
        <p class="modal-description">Enter your PIN code and we will send you a secure reset link to your registered email.</p>

        <label class="form-field">
          <span>PIN Code</span>
          <input
            id="pinCode"
            type="text"
            inputmode="numeric"
            maxlength="6"
            formControlName="pinCode"
            placeholder="Enter your PIN"
            (input)="onPinInputForgot($event)"
            [class.invalid]="forgotPasswordForm.get('pinCode')?.invalid && forgotPasswordForm.get('pinCode')?.touched"
          />
          @if (forgotPasswordForm.get('pinCode')?.invalid && forgotPasswordForm.get('pinCode')?.touched) {
            <span class="error-text">Please enter a valid 4-6 digit PIN</span>
          }
        </label>

        <label class="form-field">
          <span>Language</span>
          <select id="locale" formControlName="locale">
            <option value="en">English</option>
            <option value="pl">Polski</option>
          </select>
        </label>

        @if (successMessage()) {
          <div class="status-message success">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm-1 12L3 8l1.4-1.4L7 9.2l4.6-4.6L13 6l-6 6z" />
            </svg>
            {{ successMessage() }}
          </div>
        }

        @if (errorMessage()) {
          <div class="status-message error">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 13H7v-2h2v2zm0-3H7V4h2v6z" />
            </svg>
            {{ errorMessage() }}
          </div>
        }

        <div class="modal-actions">
          <button type="button" class="cancel-button" (click)="onCloseForgotPassword()">
            Cancel
          </button>
          <button
            type="submit"
            class="submit-button"
            [disabled]="forgotPasswordForm.invalid || isLoading()"
          >
            @if (isLoading()) {
              <span class="spinner"></span>
              <span>Sending...</span>
            } @else {
              <span>Send reset link</span>
            }
          </button>
        </div>
      </form>
    </div>
  </div>
}
