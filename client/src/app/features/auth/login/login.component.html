<app-header />

<div class="login-container">
  <!-- Animated Background -->
  <div class="animated-bg">
    <div class="bubble bubble-1"></div>
    <div class="bubble bubble-2"></div>
    <div class="bubble bubble-3"></div>
    <div class="bubble bubble-4"></div>
    <div class="bubble bubble-5"></div>
  </div>

  <!-- Login Card -->
  <div class="login-card">
    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
      <h3 class="form-title">Sign In</h3>
      
      <div class="form-group">
        <label for="pinCode" class="form-label">PIN Code</label>
        <input
          id="pinCode"
          type="password"
          formControlName="pinCode"
          class="form-input pin-input"
          placeholder="Enter 4-6 digit PIN"
          maxlength="6"
          inputmode="numeric"
          (input)="onPinInput($event)"
          [class.error]="loginForm.get('pinCode')?.invalid && loginForm.get('pinCode')?.touched"
        />
        @if (loginForm.get('pinCode')?.invalid && loginForm.get('pinCode')?.touched) {
          <span class="error-text">PIN code must be 4-6 digits</span>
        }
      </div>

      <div class="form-group">
        <div class="label-with-link">
          <label for="password" class="form-label">Password</label>
          <button type="button" class="forgot-link" (click)="onForgotPassword()">Forgot?</button>
        </div>
        <input
          id="password"
          type="password"
          formControlName="password"
          class="form-input"
          placeholder="Enter your password"
          [class.error]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched"
        />
        @if (loginForm.get('password')?.invalid && loginForm.get('password')?.touched) {
          <span class="error-text">Password must be at least 6 characters</span>
        }
      </div>

      @if (errorMessage()) {
        <div class="error-message">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 13H7v-2h2v2zm0-3H7V4h2v6z"/>
          </svg>
          {{ errorMessage() }}
        </div>
      }

      <button 
        type="submit" 
        class="login-button"
        [disabled]="loginForm.invalid || isLoading()"
      >
        @if (isLoading()) {
          <span class="spinner"></span>
          <span>Authenticating...</span>
        } @else {
          <span>Sign In</span>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0L6.59 1.41L12.17 7H0v2h12.17l-5.58 5.59L8 16l8-8z"/>
          </svg>
        }
      </button>

      <div class="divider">
        <span>or continue with</span>
      </div>

      <button type="button" class="oauth-button" (click)="loginWithGoogle()">
        <svg viewBox="0 0 533.5 544.3" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path fill="#4285F4" d="M533.5 278.4c0-17.4-1.4-34-4-50.2H272v95.1h146.9c-6.4 34.6-26 63.9-55.4 83.4v69.2h89.4c52.4-48.3 80.6-119.5 80.6-197.5z"/>
          <path fill="#34A853" d="M272 544.3c74.7 0 137.4-24.7 183.2-67.4l-89.4-69.2c-24.8 16.7-56.6 26.5-93.8 26.5-72 0-133-48.6-154.6-113.8H24.5v71.4C70.5 483.1 164.6 544.3 272 544.3z"/>
          <path fill="#FBBC05" d="M117.4 320.4c-10.5-31.6-10.5-65.7 0-97.3V151.7H24.5c-44.2 87.9-44.2 192.8 0 280.6l92.9-71.9z"/>
          <path fill="#EA4335" d="M272 107.7c39.6-.6 77.3 14 106.1 41.3l79.1-79.1C409.3 24.3 345.9-2.1 272 0 164.6 0 70.5 61.2 24.5 151.7l92.9 71.4C139 156.3 200 107.7 272 107.7z"/>
        </svg>
        <span>Sign in with Google</span>
      </button>
    </form>
  </div>

  <!-- Forgot Password Modal -->
  @if (showForgotPassword()) {
    <div class="modal-overlay" (click)="onCloseForgotPassword()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Reset Password</h3>
          <button type="button" class="close-button" (click)="onCloseForgotPassword()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"/>
            </svg>
          </button>
        </div>
        
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmitForgotPassword()" class="forgot-password-form">
          <p class="modal-description">Enter your email address and we'll send you a link to reset your password.</p>
          
          <div class="form-group">
            <label for="emailAddress" class="form-label">Email Address</label>
            <input
              id="emailAddress"
              type="email"
              formControlName="emailAddress"
              class="form-input"
              placeholder="your@email.com"
              [class.error]="forgotPasswordForm.get('emailAddress')?.invalid && forgotPasswordForm.get('emailAddress')?.touched"
            />
            @if (forgotPasswordForm.get('emailAddress')?.invalid && forgotPasswordForm.get('emailAddress')?.touched) {
              <span class="error-text">Please enter a valid email address</span>
            }
          </div>

          <div class="form-group">
            <label for="locale" class="form-label">Language</label>
            <select
              id="locale"
              formControlName="locale"
              class="form-input"
            >
              <option value="en">English</option>
              <option value="pl">Polski</option>
            </select>
          </div>

          @if (successMessage()) {
            <div class="success-message">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm-1 12L3 8l1.4-1.4L7 9.2l4.6-4.6L13 6l-6 6z"/>
              </svg>
              {{ successMessage() }}
            </div>
          }

          @if (errorMessage()) {
            <div class="error-message">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 13H7v-2h2v2zm0-3H7V4h2v6z"/>
              </svg>
              {{ errorMessage() }}
            </div>
          }

          <div class="modal-actions">
            <button type="button" class="cancel-button" (click)="onCloseForgotPassword()">
              Cancel
            </button>
            <button 
              type="submit" 
              class="submit-button"
              [disabled]="forgotPasswordForm.invalid || isLoading()"
            >
              @if (isLoading()) {
                <span class="spinner"></span>
                <span>Sending...</span>
              } @else {
                <span>Send Reset Link</span>
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
